<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./assets/css/reset.css">
    <link rel="stylesheet" href="./assets/css/structure.css">
    <link rel="stylesheet" href="./assets/css/main.css">
    <link rel="shortcut icon" href="./assets/img/atelier_logo_tiny.svg" type="image/svg+xml">
    <title>Atelier Elizeu Manoel - Login</title>
</head>
<body style="overflow: hidden;">
    <span class="r mcenter ccenter w12 h12" id="loading-screen">
        <img src="./assets/img/loading.gif" style="height: 8rem;" draggable="false">
    </span>
    <script src="./assets/js/jquery-3.6.1.min.js"></script>
    <script src="./assets/js/constants.js"></script>
    <script src="./assets/js/main.js"></script>
    <script>
        getColors();
        async function getColors() {
            addLoading();
            await $.get(apiUrl + "/color")
            .done(function (data) {
                let response = $.parseJSON(data);
                if (response.status == 1) {
                    let colors = response.result;
                    for (let i = 0; i < colors.length; i++) {
                        let color = colors[i];
                        window.document.body.style.setProperty(color.name, color.value);
                    }
                    subLoading();
                } else if (response.status == -1) {
                    window.alert(internalErrorMessage);
                }
            })
            .fail(function () {
                window.alert(unknownErrorMessage);
            });
        }
    </script>

    <main id="login-main-banner" class="c mcenter ccenter w12">
        <section class="c p4 mcenter ccenter w12 w8-lmd w7-hmd w6-llg w5-hlg ovisible ">
            <div class="c mcenter ccenter g2 wauto hauto">
                <a class="i w12 bgLight main-menu-link" style="border-radius: 20px;" href="./#home"><p class="text-center">Criar Novo Registro</p></a>
                <form action="" class="c p4 mcenter ccenter g4 w12 hauto bgLight" name="frmRegister" id="frmRegister" style="border-radius: 20px;" method="post">
                    <div class="error" id="error-display"></div>
                    <div class="r g4 ">
                        <div class="c g1">
                            <p>Nível de Usuário</p>
                            <div class="container-overflow ">   
                                <h5 class="r mcenter ccenter w12 ">Permissão 1 (Alterar Logo do Menu)</h5>
                                <label class="r g1 hauto " for="nivel">
                                    <input type="radio" class="nivel"  name="nivel0" id="nivel0" placeholder="Nível" required value="1">
                                    <label for="" class="">Sim</label>
                                    <input type="radio" class="nivel" name="nivel0" id="nivel0" value="0">
                                    <label for="" class="">Não</label>
                                </label>
                                <h5 class="r mcenter ccenter w12 ">Permissão 1 (Alterar Logo do Menu)</h5>
                                <label class="r g1 hauto " for="nivel">
                                    <input type="radio" class="nivel"  name="nivel1" id="nivel1" placeholder="Nível" required value="1">
                                    <label for="" class="">Sim</label>
                                    <input type="radio" class="nivel" name="nivel1" id="nivel1" value="0">
                                    <label for="" class="">Não</label>
                                </label>
                                <h5 class="r mcenter ccenter w12 ">Permissão 1 (Alterar Logo do Menu)</h5>
                                <label class="r g1 hauto " for="nivel">
                                    <input type="radio" class="nivel"  name="nivel2" id="nivel0" placeholder="Nível" required value="1">
                                    <label for="" class="">Sim</label>
                                    <input type="radio" class="nivel" name="nivel2" id="nivel0" value="0">
                                    <label for="" class="">Não</label>
                                </label>
                                <h5 class="r mcenter ccenter w12 ">Permissão 1 (Alterar Logo do Menu)</h5>
                                <label class="r g1 hauto " for="nivel">
                                    <input type="radio" class="nivel"  name="nivel3" id="nivel0" placeholder="Nível" required value="1">
                                    <label for="" class="">Sim</label>
                                    <input type="radio" class="nivel" name="nivel3" id="nivel0" value="0">
                                    <label for="" class="">Não</label>
                                </label>
                                <h5 class="r mcenter ccenter w12 ">Permissão 1 (Alterar Logo do Menu)</h5>
                                <label class="r g1 hauto " for="nivel">
                                    <input type="radio" class="nivel"  name="nivel4"  placeholder="Nível" required value="1">
                                    <label for="" class="">Sim</label>
                                    <input type="radio" class="nivel" name="nivel4"  value="0">
                                    <label for="" class="">Não</label>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="error" id="email-error">E-mail inválido</div>
                    <div class="error" id="email-required">E-mail é obrigatório</div>
                    <div>
                        <p>Nome</p>
                        <label class="r mcenter ccenter g1 w12 hauto text-input-wrapper" for="name">
                            <input class="i text-input" type="name" name="name" id="name" placeholder="Nome" required>
                        </label>
                    </div>
                    <div>
                        <p>Email</p>
                        <label class="r mcenter ccenter g1 w12 hauto text-input-wrapper" for="email">
                            <input class="i text-input" type="email" name="email" id="email" placeholder="Email" required>
                        </label>
                    </div>
                    
                    <div>
                        <p>Senha</p>
                        <label class="r mcenter ccenter g1 w12 hauto text-input-wrapper" for="password">
                            <input class="i text-input" type="password" name="password" id="password" placeholder="Senha" required>
                        </label>
                    </div>
                    <div>
                        <p>Confirma Senha</p>
                        <label class="r mcenter ccenter g1 w12 hauto text-input-wrapper" for="password">
                            <input class="i text-input" type="password" name="passwordConfirm" id="password" placeholder="Senha" required>
                        </label>
                    </div>

                    <div>
                        <label class=" r mcenter ccenter g1 w12 " for="permission">
                            <input class=" i" type="hidden" name="permission" id="permission" required readonly>
                        </label>
                    </div>
                    <input class="i submit-button" type="submit" value="Register">
                </form>
            </div>
        </section>

        <!-- <section class="c p2 mcenter ccenter w10 bgLight ">
            <form action="" class="w6" id="frmDelete">
                <div class="c p4 bgLight mcenter ccenter w6 g6">
                <h5 class="r">Usuários Cadastrados</h5>
                <label class="r mcenter ccenter g1 w12 hauto text-input-wrapper" for="password">
                    <input type="number" class="r i text-input" name="userId" id="deleteArea">
                </label>
                <input class="i r submit-button" type="submit" value="Deletar" id="delete">
                <input class="i r submit-button" type="submit" value="List" id="list">
                </div>
            </form>
         </section> -->

        <section class="r p2 mcenter ccenter w8 bgDark hauto radius m-b-footer">
            <li class="r mevenly w12" >
                <div class="title-alter">Código</div>
                <div class="title-alter">Nome</div>
                <div class="title-alter">Permissões</div>
            </li>
        </section>

        <section class="c p2 mcenter ccenter w8 bgDark hauto radius" id="sectionUser">
        </section>
        

    </main>
    
    <script>
        getUserList();
        async function getUserList(){
            await $.get(apiUrl + "/user")
            .done(function (data) { 
                response = $.parseJSON(data);
                if (response.status == 1) {
                    response.result.forEach(user => {
                        $('#sectionUser')
                        .append(
                            '<li class="r mevenly w12 listUser ">' +
                                '<form class = "r w12 mcenter ccenter " action="" data-frmList = "true" >'+
                                    '<input class = "r  w12 ccenter mccenter input-register" value = ' + user.id  +' readonly>' + 
                                    '<input class = "r  w12 ccenter mcenter input-register" value = ' + user.name  +' readonly>' +
                                    '<input class = "r  w12 ccenter mcenter input-register"value = ' + user.permission_type  +' readonly>' +
                                    '<div class = " ">' + 
                                        '<input class="i r submit-button delete" type="button" value="Deletar">' + 
                                    '</div>' +
                                    '<div class = "">' + 
                                        '<input class="i r submit-button modify" type="button" value="Alterar">' + 
                                    '</div>' +
                                '</form>'+
                            '</li>'

                            
                        );
                        $('.delete').last().on("click", function() {
                        info = "userId= " + user.id; 
                        console.log(info)
                        
                        $.ajax({
                            type: 'DELETE',
                            dataType: 'json',
                            url: apiUrl + "/user",
                            data: info,
                            async: true,
                            success: function(response) {
                                location.reload();
                            }
                        });

                        return false;
                        });
                        $('.modify').last().on("click", function () { 
                            window.open("register_modify.html?id="+ user.id);

                        });

                    });  
                    
                } else if (response.status == 0) {
                    window.alert(response.message);
                } else {
                    window.alert(internalErrorMessage);
                }
            })    
            
        } 
        
        
        $("#frmRegister").on("submit", function (event) {
            level = document.querySelectorAll(".nivel")
            data= [];
            console.log(level);
            for (let i = 0; i < level.length; i++) {
                if (level[i].type == 'radio') {
                    if (level[i].checked) {
                        data.push(level[i].value) 
                    }
                }    
            }
            levelResult = data.join('');
            document.getElementById('permission').value = levelResult;

            event.preventDefault();
            $.post(apiUrl + "/user", $(this).serialize())
            .done(function (data) {
                console.log(data);
                response = $.parseJSON(data);
                if (response.status == 1) {
                     $("#error-display").css("display", "none");
                     window.location.href = baseUrl + "/#home";
                } else if (response.status == 0) {
                     $("#error-display").html(response.message).css("display", "block");
                } else {
                     $("#error-display").html(internalErrorMessage).css("display", "block");
                }
            })
             .fail(function () {
                 $("#error-display").html(unknownErrorMessage).css("display", "block");
            });
        });
        
    </script>
</body>
</html>

<!--Toda vez que eu passar um determinado valor eu terei que concatená-lo a fim de transformar em uma string-->
